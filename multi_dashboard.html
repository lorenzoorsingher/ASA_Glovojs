<!-- index.html -->
<link href="/path/to/dashboard.css" />
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dashboard</title>
  </head>
  <body>
    <h1>Dashboard</h1>

    <div id="mapdiv">
      <table
        id="myTable"
        class="table table-borderless table-striped table-earning"
      >
        <tbody id="mapTable"></tbody>
      </table>
    </div>
    <div id="info"></div>
    <div id="carrying"></div>
    <div id="carrying_points"></div>

    <div id="carry_div">
      <table style="border: 1px solid black" id="my_carry_table">
        <tbody id="carry_table"></tbody>
      </table>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();

      socket.on("update", (data) => {
        document.getElementById("updates").innerText = JSON.stringify(data);
      });

      socket.on("map", (data) => {
        w = data["map_size"][0];
        h = data["map_size"][1];
        tiles = data["tiles"];
        parcels = data["parc"];
        riders = data["riders"];

        let pathcolors = ["blue", "violet", "grey", "darkgreen"];
        let ridercolor = ["lightblue", "pink", "lightgrey", "MediumSeaGreen"];
        //   document.getElementById('info').innerHTML = "<div><h2>"+plan_target+"</h2><div>";

        //   document.getElementById('carrying').innerHTML = "<div>"+rider_parcels.map((el, idx) => {
        //   return (el.key);
        //  });"<div>";

        //  document.getElementById('carrying_points').innerHTML =  "<div><h2>"+carrying+" points </h2><div>";

        const table = document.getElementById("mapTable");
        table.innerHTML = "";

        // console.log(data["parc"]);

        for (let i = 0; i < h; i++) {
          let y = h - i - 1;
          let row = table.insertRow();

          for (let j = 0; j < w; j++) {
            let x = j;

            let tile = row.insertCell();

            tile_html = "<div style='display: table;width:100%;height:100%;'>";
            tile.style.width = "20px";
            tile.style.height = "20px";
            let color = "black";
            switch (tiles[y][j]["type"]) {
              case "W":
                color = "green";
                break;
              case "D":
                color = "red";
                break;
            }

            cell_id = x + "-" + y;
            //console.log(str);
            let pardone = false;
            let to_pickup = false;
            for (let rid = 0; rid < riders.length; rid++) {
              plan_move = riders[rid].plan[0];
              plan_pickup = riders[rid].plan[1];
              plan_drop = riders[rid].plan[2];
              blk_agents = riders[rid].blk_agents;

              if (plan_move.includes(cell_id)) {
                pathcolor = pathcolors[rid];
                tile_html +=
                  "<div style='width:80%;height:80%;background-color:" +
                  pathcolor +
                  ";'></div>";
              }

              if (!pardone) {
                for (p of parcels) {
                  if (p.x == x && p.y == y) {
                    color = "yellow";
                    tile_html +=
                      "<div style='position: absolute;'><b>" +
                      p.reward +
                      "</b></div>";
                  }
                }
                pardone = true;
              }

              if (plan_pickup.includes(cell_id)) {
                to_pickup = true;
                //color = "GreenYellow";
              } else if (plan_drop.includes(cell_id)) {
                color = "orange";
              }
            }
            if (to_pickup) {
              color = "GreenYellow";
            }
            for (let rid = 0; rid < riders.length; rid++) {
              blk_agents = riders[rid].blk_agents;

              if (blk_agents.includes(cell_id)) {
                color = "purple";
              }
            }
            tile_html += "</div>";

            tile.innerHTML = tile_html;
            tile.style.backgroundColor = color;
          }
          let tile = row.insertCell();
          tile.innerHTML = "<div>" + y + "</div>";
        }
        let row = table.insertRow();
        for (let j = 0; j < w; j++) {
          let tile = row.insertCell();
          tile.innerHTML = "<div>" + j + "</div>";
        }

        for (let rid = 0; rid < riders.length; rid++) {
          rider = riders[rid];

          table.rows[Math.round(h - rider.y) - 1].cells[
            Math.round(rider.x)
          ].innerHTML = "<div ></div>";
          table.rows[Math.round(h - rider.y) - 1].cells[
            Math.round(rider.x)
          ].style.backgroundColor = ridercolor[rid];
        }

        // TABLE OF CARRIED PARCELS

        const carry_table = document.getElementById("carry_table");
        carry_table.innerHTML = "";

        for (let rid = 0; rid < riders.length; rid++) {
          rider_parc = riders[rid].parcels;
          // console.log("rp: ", rider_parc);
          for (let i = 0; i < rider_parc.length; i++) {
            let row = carry_table.insertRow();

            row.style.border = "1px solid #000";

            let rider_cell = row.insertCell();
            let key_cell = row.insertCell();
            let rew_cell = row.insertCell();

            rider_cell.style.border = "1px solid #000";
            rider_cell.style.backgroundColor = ridercolor[rid];
            key_cell.style.border = "1px solid #000";
            rew_cell.style.border = "1px solid #000";

            parcel = rider_parc[i];

            rider_cell.innerHTML = "<div><b>Rider " + rid + "</b></div>";
            key_cell.innerHTML = "<div><b>" + parcel.key + "</b></div>";
            rew_cell.innerHTML = "<div><b>" + parcel.reward + "</b></div>";
          }
        }
      });
    </script>
  </body>
</html>
